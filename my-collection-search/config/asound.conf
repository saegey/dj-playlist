# ALSA Configuration for Software Mixing (dmix)
# This allows multiple applications to play audio simultaneously through your USB DAC
#
# Place this file at:
# - /etc/asound.conf (system-wide, recommended for Docker)
# - ~/.asoundrc (per-user)
#
# To use in Docker, mount as volume: ./config/asound.conf:/etc/asound.conf:ro

# Define the hardware device
# Replace 'DAC' with your actual card name from 'aplay -l'
# Replace '1' with your actual card number
pcm.!default {
    type asym
    playback.pcm "dmixed"
    capture.pcm "hw:1,0"
}

# Software mixing device
pcm.dmixed {
    type plug
    slave.pcm "dmixer"
}

# dmix configuration
pcm.dmixer {
    type dmix
    ipc_key 1024  # Unique key for shared memory
    ipc_perm 0666 # Permissions (allow all users)

    slave {
        # Hardware parameters
        pcm "hw:1,0"  # Change '1' to your USB DAC card number

        # Audio format settings
        # Adjust these to match your DAC's native capabilities
        rate 48000    # Sample rate (44100, 48000, 96000, 192000, etc.)
        channels 2    # Stereo
        format S16_LE # 16-bit signed little-endian (or S24_LE, S32_LE)

        # Buffer settings for low latency
        period_time 0
        period_size 1024  # Smaller = lower latency, higher CPU
        buffer_size 8192  # Larger = more stable, higher latency
    }

    bindings {
        0 0  # Left channel
        1 1  # Right channel
    }
}

# Control device (for mixer controls)
ctl.!default {
    type hw
    card 1  # Change to your USB DAC card number
}

# Optional: Define a direct hardware device for exclusive access
# Use this if you want the option to bypass dmix for critical listening
pcm.direct_hw {
    type plug
    slave.pcm "hw:1,0"  # Direct hardware access
}

# Optional: High-quality resampling (requires libasound2-plugins)
# Uncomment if you have samplerate converter plugin installed
# defaults.pcm.rate_converter "samplerate_best"
