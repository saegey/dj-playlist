# MPD Configuration for DAC Playback
# Music Player Daemon - Professional audio playback

# Directory where music files are stored
music_directory     "/var/lib/mpd/music"
playlist_directory  "/var/lib/mpd/playlists"
db_file             "/var/lib/mpd/database"
log_file            "/var/log/mpd/mpd.log"
pid_file            "/var/run/mpd/pid"
state_file          "/var/lib/mpd/state"
sticker_file        "/var/lib/mpd/sticker.sql"

# Network settings - bind to all interfaces so container can access it
bind_to_address     "0.0.0.0"
port                "6600"

# Logging
log_level           "default"

# Audio output to ALSA (USB DAC)
audio_output {
    type            "alsa"
    name            "USB DAC"
    device          "plughw:1,0"  # Will be overridden by environment variable
    mixer_type      "software"
    # Enable format conversion - ALSA handles this more efficiently than FFmpeg
    auto_resample   "yes"
    auto_channels   "yes"
    auto_format     "yes"
    # Large ALSA buffers to prevent xruns (underruns)
    buffer_time     "500000"      # 500ms buffer
    period_time     "100000"      # 100ms period
    # Use larger format for better performance
    format          "44100:16:2"  # 44.1kHz, 16-bit, stereo
}

# Optional: HTTP streaming output (for monitoring)
audio_output {
    type            "httpd"
    name            "HTTP Stream"
    encoder         "vorbis"
    port            "8000"
    bind_to_address "0.0.0.0"
    quality         "5.0"
    format          "44100:16:2"
    always_on       "yes"
    tags            "yes"
}

# Performance settings
# Large buffer to prevent decoder bottlenecks and xruns
# Trade-off: ~700ms latency, but smooth playback
audio_buffer_size   "32768"  # 32MB buffer (increased from 8MB)

# Use internal resampler (always available, good performance)
resampler {
    plugin          "internal"
}

# Decoder configuration
# More threads = better performance for complex formats like AAC
decoder {
    plugin          "ffmpeg"
    enabled         "yes"
}

# Character encoding
filesystem_charset  "UTF-8"
